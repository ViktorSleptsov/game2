name: CI Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    
    - name: Install tkinter (for GUI tests)
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-tk xvfb
    
    - name: Run unit tests
      run: |
        if [ -d "tests" ]; then
          xvfb-run -a pytest tests/ -v
        else
          echo "No tests folder found, skipping unit tests"
          exit 1
        fi

  lint:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pylint
    
    - name: Run static code analyzer (pylint)
      run: |
        # Находим все Python файлы для анализа
        PYTHON_FILES=$(find . -name "*.py" -not -path "./tests/*" -not -path "./.*")
        if [ -n "$PYTHON_FILES" ]; then
          pylint $PYTHON_FILES --exit-zero
        else
          echo "No Python files found for analysis"
        fi